\section{Appendix B: Expected error reduction}\label{app:EER}

Here we provide the proof of Proposition~\ref{prp:EER}.
\EER*
\begin{proof}
We recall that Equation~\eqref{eq:alpha-LR-general} defines the expected error reduction as
\[
    \alpha_{\mc D, \text{LR}}(p, p') = 
    \bb E _{ (Y_p, \nu) \sim \mc U( \mc PI_p \times  [-\tau_p, \tau_p] ^{ \text{dim} \mc Y } )} 
    \left[ 
        e_{D(\mc D), \text{LR}}(p')- e_{D(p,\tau_p, Y_p + \nu ), \text{LR}}(p')
    \right],
\]
and in the hypothesis of the proposition we have that $\mc PI_p$ is a multivariate interval with lower and upper bounds given by Equations~\eqref{eq:LR-bounds}.\newline
As $\mc PI_p$ is a multivariate interval, we can use Equation~\eqref{eq:loc-err-LR} and have for every training set $D$, $p\in \Theta$
\[
    e_{D, \text{LR}}(p) = \frac{1}{2\sqrt{3}} \sum_{j=1}^{\text{dim}\mc Y} \left( UB_{D}^{(j)}(p) - LB_{D}^{(j)}(p) \right),
\]
where we added the subscript $D'$ to the bounds as in this proposition there are different training sets involved, and we will continue to do so in the rest of the proof.\newline
Then, we have that 
\begin{flalign*}
    e_{D(\mc D), \text{LR}}(p')&- e_{D(p,\tau_p, Y_p + \nu ), \text{LR}}(p') = \\
    &= \frac{1}{2\sqrt{3}} \sum_{j=1}^{\text{dim}\mc Y} \left(  \left( UB_{D(\mc D)}^{(j)}(p') - UB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right) - \left( LB_{D(\mc D)}^{(j)}(p') - LB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right) \right),
\end{flalign*}
which we insert in the expression of $\alpha_{\mc D, \text{LR}}(p, p')$ to obtain, after using the linearity of the expectation operator, the following equality:
\begin{flalign}
    \alpha_{\mc D, \text{LR}}(p, p') = \frac{1}{2\sqrt{3}} \sum_{j=1}^{\text{dim}\mc Y}\Big( &\bb E _{ (Y_p, \nu) \sim \mc U\left( \mc PI_p \times  [-\tau_p, \tau_p] ^{ \text{dim} \mc Y } \right)} \left[  \left( UB_{D(\mc D)}^{(j)}(p') - UB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right)\right] - \label{eq:EER-proof-1} &&\\
    & \qquad - \bb E _{ (Y_p, \nu) \sim \mc U\left( \mc PI_p \times  [-\tau_p, \tau_p] ^{ \text{dim} \mc Y } \right)} \left[  \left( LB_{D(\mc D)}^{(j)}(p') - LB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right) \right]\Big). &&\notag
\end{flalign}
BY observing that as $\mc PI_p$ is an interval all the components of $(Y_p,\nu)$ are independent, and that both $UB_D^{(j)}$ depends on the $j$-th component of the training data only, we can write 
\begin{flalign*}
    &\bb E _{ (Y_p, \nu) \sim \mc U\left( \mc PI_p \times  [-\tau_p, \tau_p] ^{ \text{dim} \mc Y } \right)} \left[  \left( UB_{D(\mc D)}^{(j)}(p') - UB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right)\right] = && \\
    & \qquad\qquad =\bb E _{ \left(Y_p^{(j)}, \nu^{(j)}\right) \sim \mc U\left( \left[LB^{(j)}_{D(\mc D)}(p), UB^{(j)}_{D(\mc D)}(p)\right] \times  [-\tau_p, \tau_p] \right)} \left[  \left( UB_{D(\mc D)}^{(j)}(p') - UB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') \right)\right] = &&\\
    & \qquad\qquad = \frac{1}{2\tau_p \left(  UB^{(j)}_{D(\mc D)}(p)- LB^{(j)}_{D(\mc D)}(p) \right) } \int_{UB^{(j)}_{D(\mc D)}(p)}^{LB^{(j)}_{D(\mc D)}(p)} \int_{-\tau_p}^{\tau_p} UB_{D(\mc D)}^{(j)}(p') - UB_{D(p,\tau_p, y + n )}^{(j)}(p') \,dn \, dy &&\\
    & \qquad\qquad \eqcolon \frac{ EUI^{(j)}(p,p')}{2\tau_p \left(  UB^{(j)}_{D(\mc D)}(p)- LB^{(j)}_{D(\mc D)}(p) \right) }  &&,
\end{flalign*}
and similarly for the term with the lower bounds, resulting in the integral term $ELI^{(j)}(p,p')$.\newline
By inserting the above in Equation~\eqref{eq:EER-proof-1} and factoring out $\frac{1}{2\tau_p}$, we obtain that Equation~\eqref{eq:loc-err-LR} holds (note that in the statement $UB$ and $LB$ do not have any subscript, but they are what we are denoting with $UB_{D(\mc D)}$ and $LB_{D(\mc D)}$ respectively).\newline
We now need to compute the integrals $EUI^{(j)}(p,p')$ and $ELI^{(j)}(p,p')$: due to symmetry reasons (the lower bound is the negative of the upper bound resulting from data with a change of sign $\tilde y^{(j)} = - y^{(j)} $), it suffices to compute $EUI$ only.\newline
By Equations~\eqref{eq:LR-bounds} and by the fact that $D(p,\tau_p, Y_p + \nu ) = D (\mc D) \cup \{ (p, \tau_p, Y_p + \nu ) \}$, we have that \[
    UB_{D(p,\tau_p, Y_p + \nu )}^{(j)}(p') = \min \left( UB_{D(\mc D)}^{(j)}(p'), Y_p +\nu + \tau_p + L^{(j)} \|p'-p \|_\Theta \right),
\]
allowing us to write 
\[
    EUI^{(j)}(p,p') = \int_{LB^{(j)}_{D(\mc D)}(p)}^{UB^{(j)}_{D(\mc D)}(p)} \int_{-\tau_p}^{\tau_p} \max \left( 0, UB_{D(\mc D)}^{(j)}(p') - Y_p -n - \tau_p - L^{(j)} \|p'-p \|_\Theta \right) \,dn \, dy.
\]
We collect the constant terms in the constant $c_1^j = UB^{(j)}_{D(\mc D)}(p') - \tau_p - L^{(j)} \|p'-p \|_\Theta$. 
The treatment of the integral depends on the interplay between $c_1^j$, $UB^{(j)}_{D(\mc D)}(p)$, $LB^{(j)}_{D(\mc D)}(p)$ and $\tau_p$, as in certain cases it will be more convenient to integrate in one order than in the other; consequently, we treat the cases separately.
Note that as $UB^{(j)}_{D(\mc D)}(p) \geq LB^{(j)}_{D(\mc D)}(p)$, some more inequalities will be left implicit.\medskip
\pv{the intuition why these cases work is not explicit, a picture may be added}
\textbf{Case 1:} $UB^{(j)}(p) \leq c_1^j - \tau_p $. \smallskip \newline
As $UB^{(j)}(p) +\tau_p \leq c_1^j$, we have \[
    \max \left( 0, c_1^j - y - n \right) = c_1^j - y - n \ \text{ for all } \ (y,n) \in \left[LB^{(j)}_{D(\mc D)}(p), UB^{(j)}_{D(\mc D)}(p)\right] \times [-\tau_p, \tau_p],
\] 
thus 
\begin{flalign*}
    EUI^{(j)}(p,p') &= \int_{LB^{(j)}_{D(\mc D)}(p)}^{UB^{(j)}_{D(\mc D)}(p)} \int_{-\tau_p}^{\tau_p} c_1^j - y - n \,dn \, dy = && \\
    &= c_1^j \cdot 2 \tau_p \cdot \left( UB^{(j)}_{D(\mc D)}(p) - LB^{(j)}_{D(\mc D)}(p) \right) - 2 \tau_p \cdot \frac{1}{2} \left( UB^{(j)}_{D(\mc D)}(p)^2 - LB^{(j)}_{D(\mc D)}(p)^2 \right) = &&\\
    &= \tau_p \left( UB^{(j)}_{D(\mc D)}(p) - LB^{(j)}_{D(\mc D)}(p) \right) \left( 2 c_1^j - UB^{(j)}_{D(\mc D)}(p) - LB^{(j)}_{D(\mc D)}(p) \right)   &&
\end{flalign*}
holds as stated. \medskip
% case 5 on paper

\textbf{Case 2:} $c_1^j + \tau_p < UB^{(j)}(p) $ and $ LB^{(j)}(p) \leq c_1^j - \tau_p$. \smallskip \newline
As we have that 
\begin{equation}\label{eq:EER-proof-2}
    \max \left( 0, c_1^j - y - n \right) = 0 \ \text{ for all } \ (y,n) \ \text{ such that } \ y + n \geq c_1^j,
\end{equation}
holds, in this case we write the integral as
\begin{flalign*}
    EUI^{(j)}(p,p') &= \int_{-\tau_p}^{\tau_p} \int_{LB^{(j)}_{D(\mc D)}(p)}^{c_1^j - n}  c_1^j - y - n \,dy \, dn = && \\
    &= \int_{-\tau_p}^{\tau_p} \left( c_1^j - n \right) \cdot \left( c_1^j - n - LB^{(j)}_{D(\mc D)}(p) \right) - \frac{1}{2} \left( \left( c_1^j - n \right)^2 - LB^{(j)}_{D(\mc D)}(p)^2 \right) \, dn = && \\
    &= \int_{-\tau_p}^{\tau_p} \frac{1}{2} \left( c_1^j - n  - LB^{(j)}_{D(\mc D)}(p)\right)^2  \, dn = && \\
    &= \frac{1}{6 }\left( \left( c_1^j + \tau_p  - LB^{(j)}_{D(\mc D)}(p)\right)^3 - \left( c_1^j - \tau_p  - LB^{(j)}_{D(\mc D)}(p)\right)^3 \right), &&
\end{flalign*}
which is the desired result. \medskip
%case 1 on paper 

\textbf{Case 3:} $c_1^j + \tau_p < UB^{(j)}(p) $ and $ c_1^j - \tau_p < LB^{(j)}(p) \leq c_1^j + \tau_p$. \smallskip \newline
In this case we use Equation~\eqref{eq:EER-proof-2} and write the following equalities
\begin{flalign*}
    EUI^{(j)}(p,p') &= \int_{-\tau_p}^{c_1^j - LB^{(j)}_{D(\mc D)}(p)} \int_{LB^{(j)}_{D(\mc D)}(p)}^{c_1^j - n}  c_1^j - y - n \,dy \, dn = && \\
    &= \int_{-\tau_p}^{LB^{(j)}_{D(\mc D)}(p)} \left( c_1^j - n \right) \cdot \left( c_1^j - n - LB^{(j)}_{D(\mc D)}(p) \right) - \frac{1}{2} \left( \left( c_1^j - n \right)^2 - LB^{(j)}_{D(\mc D)}(p)^2 \right) \, dn = && \\
    &= \int_{-\tau_p}^{LB^{(j)}_{D(\mc D)}(p)} \frac{1}{2} \left( c_1^j - n  - LB^{(j)}_{D(\mc D)}(p)\right)^2  \, dn = && \\
    &= \frac{1}{6 } \left( c_1^j + \tau_p  - LB^{(j)}_{D(\mc D)}(p)\right)^3 
\end{flalign*}
which deal the stated result.\medskip
%case 2 on paper 

\textbf{Case 4:} $ c_1^j - \tau_p < UB^{(j)}(p) \leq c_1^j + \tau_p$ and $ c_1^j - \tau_p < LB^{(j)}(p) \leq c_1^j + \tau_p$. \smallskip \newline
In this case Equation~\eqref{eq:EER-proof-2} renders it convenient to write the integral as
\begin{flalign*}
    EUI^{(j)}(p,p') &= \int_{LB^(j)_{D(\mc D)}(p)}^{UB^{(j)}_{D(\mc D)}(p)} \int_{-\tau_p}^{c_1^j - y}  c_1^j - y - n \,dn \, dy = && \\
    &= \int_{LB^{(j)}_{D(\mc D)}(p)}^{UB^{(j)}_{D(\mc D)}(p)} \left( c_1^j - y \right) \cdot \left( c_1^j - y + \tau_p \right) - \frac{1}{2} \left( \left( c_1^j - y \right)^2 - \tau_p^2 \right) \, dy = && \\
    &= \int_{LB^{(j)}_{D(\mc D)}(p)}^{UB^{(j)}_{D(\mc D)}(p)} \frac{1}{2} \left( c_1^j - y  + \tau_p\right)^2  \, dy = && \\
    &= \frac{1}{6 } \left(\left( c_1^j - LB^{(j)}_{D(\mc D)}(p) + \tau_p  \right)^3 - \left( c_1^j - UB^{(j)}_{D(\mc D)}(p) - \tau_p  \right)^3 \right), &&
\end{flalign*}
which implies the equality in the statement.\medskip
%case 3 on paper

\textbf{Case 5:} $ c_1^j - \tau_p < UB^{(j)}(p) \leq c_1^j + \tau_p $ and $ LB^{(j)}(p) \leq c_1^j - \tau_p$. \smallskip \newline
In this case, in order to solve the integral we have to split the domain in two:
\begin{flalign*}
    EUI^{(j)}(p,p') &= \int_{LB^{(j)}_{D(\mc D)}(p)}^{c_1^j - \tau_p} \int_{-\tau_p}^{\tau_p}  c_1^j - y - n \,dn \, dy + \int_{c_1^j - \tau_p}^{UB^{(j)}_{D(\mc D)}(p)} \int_{-\tau_p}^{c_1^j - y}  c_1^j - y - n \,dn \, dy = && \\
    &= 2\tau_p \int_{LB^{(j)}_{D(\mc D)}(p)}^{c_1^j - \tau_p}  c_1^j - y \,dy + \int_{c_1^j - \tau_p}^{UB^{(j)}_{D(\mc D)}(p)} \frac{1}{2} \left( c_1^j - y  + \tau_p\right)^2  \, dy = && \\
    &= 2\tau_p \left( c_1^j \left(c_1^j - \tau_p - LB^{(j)}_{D(\mc D)}(p) \right) + \frac{1}{2} \left(LB^{(j)}_{D(\mc D)}(p)^2 - (c_1^j - \tau_p)^2 \right) \right) - && \\
    & \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad  - \frac{1}{6 } \left(\left( c_1^j - UB^{(j)}_{D(\mc D)}(p) + \tau_p  \right)^3 - 8 \tau_p^3 \right) &&
\end{flalign*}
holds, dealing the desired equality. \medskip
%case 4 on paper

\textbf{Case 6:} $c_1^j + \tau_p  < LB^{(j)}(p)$. \smallskip \newline
As $LB^{(j)}(p) -\tau_p > c_1^j$, we have that 
\[
    \max \left( 0, c_1^j - y - n \right) = 0 \ \text{ for all } \ (y,n) \in \left[LB^{(j)}_{D(\mc D)}(p), UB^{(j)}_{D(\mc D)}(p)\right] \times [-\tau_p, \tau_p],
\]
so the integral is zero as stated\medskip

The above cases deal the expression for $EUI$ provided in the statement, concluding the proof.
\end{proof}
